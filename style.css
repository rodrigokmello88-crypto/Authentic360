const canvas = document.getElementById("canvasCopo");
const ctx = canvas.getContext("2d");
let imagemAtual = new Image();
let corAtual = "#ffffff";

canvas.width = 360;
canvas.height = 360;

const modelos = {
  'caneca_png.png': 'copos/caneca_png.png',
  'caneca_slim_png.png': 'copos/caneca_slim_png.png',
  'ecologico.png': 'copos/ecologico.png',
  'espumante.png': 'copos/espumante.png',
  'squeeze.png': 'copos/squeeze.png',
  'taca_gin.png': 'copos/taca_gin.png',
  'twister.png': 'copos/twister.png',
  'xicara.png': 'copos/xicara.png'
};

function trocarCopo(modelo) {
  if (!modelos[modelo]) return;
  imagemAtual.src = modelos[modelo];
  imagemAtual.onload = desenharCopo;
}

function desenharCopo() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // calcula proporção real da imagem
  const ratio = Math.min(canvas.width / imagemAtual.width, canvas.height / imagemAtual.height);
  const newWidth = imagemAtual.width * ratio;
  const newHeight = imagemAtual.height * ratio;
  const offsetX = (canvas.width - newWidth) / 2;
  const offsetY = (canvas.height - newHeight) / 2;

  // aplica cor de fundo
  ctx.fillStyle = corAtual;
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  // aplica imagem mantendo proporção
  ctx.globalCompositeOperation = "destination-in";
  ctx.drawImage(imagemAtual, offsetX, offsetY, newWidth, newHeight);
  ctx.globalCompositeOperation = "source-over";
}

function mudarCor(cor) {
  corAtual = cor;
  desenharCopo();
}

function baixarImagem() {
  const link = document.createElement("a");
  link.href = canvas.toDataURL("image/png");
  link.download = "copo_colorido.png";
  link.click();
}

document.getElementById("uploadArte").addEventListener("change", function (event) {
  const file = event.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = function (e) {
    const arte = document.getElementById("arte");
    arte.src = e.target.result;
    arte.style.display = "block";
  };
  reader.readAsDataURL(file);
});

imagemAtual.src = modelos["caneca_png.png"];
imagemAtual.onload = desenharCopo;
